#!/usr/bin/env ruby
$LOAD_PATH.unshift "lib", "ext" if $0 == "bin/c9"

require 'channel9'

debug = ARGV.include?("-d")
ARGV.delete("-d")
debug = ARGV.include?("-dd") ? :detail : debug
ARGV.delete("-dd")
print = ARGV.include?("-p")
ARGV.delete("-p")

stream = Channel9::Stream.from_json(File.read(ARGV[0]))
if (print)
  puts stream.to_json
else
  environment = Channel9::Environment.new(debug)
  context = Channel9::Context.new(environment, stream)
  context.channel_send(environment, nil, Channel9::CleanExitChannel)
end